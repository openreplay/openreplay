apiVersion: v1
kind: Secret
metadata:
  annotations:
    "helm.sh/hook": pre-install, pre-upgrade
    "helm.sh/hook-weight": "-6" # Higher precidence, so the first the config map will get created.
  name: or-secrets
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "openreplay.labels" . | nindent 4 }}
type: Opaque
data:
{{- /*

There are 2 kinds of secrets:
1. External application secrets like PG, S3, clickhouse etc
2. OpenReplay Application secrets

Type 1 can have clubed or dedicated secrets, and passwords keys are customizable.
Type 2 will be clubbed to a single secret, password keys are constant.
*/ -}}
{{- if not .Values.global.postgresql.existingSecret }}
  postgres-password: {{ .Values.global.postgresql.postgresqlPassword | b64enc }}
{{- end }}
{{- if not .Values.global.clickhouse.existingSecret }}
  clickhouse-password: {{ .Values.global.clickhouse.password | b64enc }}
{{- end }}
{{- if not .Values.global.s3.existingSecret }}
  access-key: {{ .Values.global.s3.accessKey | b64enc }}
  secret-key: {{ .Values.global.s3.secretKey | b64enc }}
{{- end }}
{{- if not .Values.global.orAppSecrets.existingSecret }}
  assist-key: {{ .Values.global.assistKey | b64enc }}
  assist-jwt-secret: {{ .Values.global.assistJWTSecret | b64enc }}
  jwt-secret: {{ .Values.global.jwtSecret | b64enc }}
  jwt-spot-secret: {{ .Values.global.jwtSpotSecret | b64enc }}
  token-secret: {{ .Values.global.tokenSecret | b64enc }}
  jwt-refresh-secret: {{ .Values.global.jwtRefreshSecret | b64enc }}
  jwt-spot-refresh-secret: {{ .Values.global.jwtSpotRefreshSecret | b64enc }}
{{- end }}
